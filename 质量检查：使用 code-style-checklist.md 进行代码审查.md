# 代码风格检查清单

## 文件结构检查 ✅

### 目录结构
- [ ] 控制器文件位于 `app/controllers/` 目录
- [ ] 服务文件位于 `app/services/` 目录  
- [ ] 路由文件位于 `app/routes/` 目录
- [ ] 模型文件位于 `app/models/` 目录
- [ ] 中间件文件位于 `middleware/` 目录
- [ ] 公共模块位于 `common/` 目录

### 文件命名
- [ ] 控制器文件以 `Controller.js` 结尾
- [ ] 服务文件以 `Service.js` 结尾
- [ ] 类名使用 PascalCase
- [ ] 文件名与类名保持一致

## 架构模式检查 ✅

### MVC分层
- [ ] 路由层只负责路由分发和中间件应用
- [ ] 控制器层只处理HTTP请求/响应和参数验证
- [ ] 服务层包含核心业务逻辑
- [ ] 模型层只负责数据访问

### 三端分离
- [ ] 用户端API使用 `/api/user` 前缀
- [ ] 管理端API使用 `/api/admin` 前缀
- [ ] 商户端API使用 `/api/merchant` 前缀

## 代码规范检查 ✅

### 类继承
- [ ] 所有控制器继承 `BaseController`
- [ ] 所有服务继承 `BaseService`
- [ ] 正确调用父类构造函数

### 方法定义
- [ ] 控制器方法使用箭头函数
- [ ] 控制器方法使用 `this.asyncHandler` 包装
- [ ] 方法名使用 camelCase

### 数据类型
- [ ] 状态值使用数字常量，不使用布尔值
- [ ] 常量名使用 UPPER_SNAKE_CASE
- [ ] 从 `common/constants/status.js` 导入状态常量

## 响应格式检查 ✅

### 成功响应
- [ ] 使用 `this.sendSuccess(res, message, data)`
- [ ] 消息使用中文描述
- [ ] 数据结构清晰合理

### 错误响应
- [ ] 使用 `this.sendError(res, message, statusCode, errors)`
- [ ] 根据错误类型返回合适的HTTP状态码
- [ ] 错误消息使用中文描述

### 分页响应
- [ ] 使用 `this.sendPaginatedResponse(res, data, pagination, message)`
- [ ] 包含完整的分页信息

## 数据库操作检查 ✅

### 事务处理
- [ ] 复杂操作使用 `this.executeTransaction`
- [ ] 事务回调函数正确传入 `transaction` 参数
- [ ] 数据库操作包含事务参数

### 缓存策略
- [ ] 使用 `this.getOrSetCache` 处理缓存
- [ ] 缓存键名规范统一
- [ ] 设置合适的TTL时间

### 查询优化
- [ ] 使用分页查询避免大量数据
- [ ] 只查询必要的字段
- [ ] 合理使用索引和关联查询

## 错误处理检查 ✅

### 异常捕获
- [ ] 所有异步方法使用 try-catch
- [ ] 错误信息详细且有意义
- [ ] 根据错误类型进行分类处理

### 日志记录
- [ ] 使用 `this.logAction` 记录操作日志
- [ ] 使用 `this.logError` 记录错误日志
- [ ] 日志信息包含必要的上下文

## 安全检查 ✅

### 输入验证
- [ ] 使用 `this.validateRequiredFields` 验证必填字段
- [ ] 使用 express-validator 进行详细验证
- [ ] 对用户输入进行清理和转义

### 认证授权
- [ ] 需要认证的接口应用认证中间件
- [ ] 检查用户权限和角色
- [ ] JWT令牌正确验证和处理

### 限流保护
- [ ] API接口应用限流中间件
- [ ] 根据接口类型设置不同的限流策略

## 注释规范检查 ✅

### 文件头注释
- [ ] 包含文件功能描述
- [ ] 说明主要职责和用途
- [ ] 使用中文注释

### 方法注释
- [ ] 包含方法功能描述
- [ ] 说明参数类型和含义
- [ ] 说明返回值格式
- [ ] 使用JSDoc格式

### 行内注释
- [ ] 关键业务逻辑有注释说明
- [ ] 复杂算法有详细注释
- [ ] 使用中文注释

## 性能优化检查 ✅

### 查询优化
- [ ] 避免N+1查询问题
- [ ] 使用合适的数据库索引
- [ ] 批量操作替代循环查询

### 缓存使用
- [ ] 频繁查询的数据使用缓存
- [ ] 缓存更新策略合理
- [ ] 缓存键名避免冲突

### 资源管理
- [ ] 数据库连接正确关闭
- [ ] 避免内存泄漏
- [ ] 合理使用连接池

## 测试覆盖检查 ✅

### 单元测试
- [ ] 核心业务逻辑有单元测试
- [ ] 测试用例覆盖主要场景
- [ ] 使用合适的断言

### 集成测试
- [ ] API接口有集成测试
- [ ] 测试数据库操作
- [ ] 测试认证和授权

## 环境配置检查 ✅

### 配置文件
- [ ] 环境变量配置完整
- [ ] 敏感信息不硬编码
- [ ] 不同环境配置分离

### 依赖管理
- [ ] package.json版本锁定
- [ ] 只安装必要的依赖
- [ ] 开发和生产依赖分离

## 部署准备检查 ✅

### Docker配置
- [ ] Dockerfile配置正确
- [ ] docker-compose.yml完整
- [ ] 镜像大小优化

### 监控日志
- [ ] 日志级别配置合理
- [ ] 日志轮转配置
- [ ] 健康检查端点

## 代码质量工具 ✅

### 静态分析
- [ ] ESLint配置并通过检查
- [ ] Prettier代码格式化
- [ ] 代码复杂度检查

### Git提交
- [ ] 提交信息规范
- [ ] 代码审查通过
- [ ] 分支管理规范

---

## 使用说明

1. **开发阶段**：在编写代码时参考此清单确保符合规范
2. **代码审查**：使用此清单进行代码审查
3. **质量保证**：定期使用此清单检查代码质量
4. **团队协作**：团队成员共同遵循此清单标准

## 自动化检查

建议配置以下自动化工具：

```bash
# 安装代码质量工具
npm install --save-dev eslint prettier husky lint-staged

# 配置Git钩子
npx husky add .husky/pre-commit "lint-staged"

# 配置lint-staged
echo '{"*.js": ["eslint --fix", "prettier --write"]}' > .lintstagedrc
```

## 检查频率

- **每次提交前**：运行基础检查
- **每周**：完整代码质量检查  
- **每月**：架构和性能检查
- **发布前**：全面质量检查

遵循此检查清单将确保代码质量和项目的长期可维护性。
